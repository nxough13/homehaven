<header id="mainHeader" style="background:#f3ede5; padding:0.7rem 2rem; display:flex; align-items:center; justify-content:space-between; border-bottom:2px solid #e0d6c6; position:fixed; top:0; left:0; width:100%; box-sizing:border-box; z-index:1001; box-shadow:0 2px 8px rgba(0,0,0,0.07);">
  <div style="display:flex; align-items:center; gap:1.2rem;">
    <a id="logoLink" href="index.html" style="display:flex; align-items:center; gap:1.2rem; text-decoration:none;">
      <img src="/our/jquery/img/logo.png" alt="Home Haven Logo" style="height:48px; width:48px;">
      <span style="font-size:2.2rem; font-family:Georgia,serif; color:#444; font-weight:600; letter-spacing:1px;">Home Haven</span>
    </a>
    <span id="jwtStatus" style="margin-left:1.5rem; font-size:1rem; font-weight:600;"></span>
  </div>
  <nav style="display:flex; align-items:center; gap:1.2rem; position:relative;">
    <span id="profileSection" style="display:inline-flex; align-items:center; gap:0.5rem;">
      <a href="#" id="profileIcon" style="color:#8B5C2A; font-size:2rem; border:2px solid #8B5C2A; border-radius:50%; padding:0.2rem; background:#f3ede5; display:inline-flex; align-items:center; justify-content:center; text-decoration:none; width:48px; height:48px; overflow:hidden;">
        <img id="profileImage" src="/our/jquery/img/logo.png" alt="Profile" style="width:100%; height:100%; object-fit:cover; border-radius:50%; display:none;">
        <span id="profileDefaultIcon" style="font-size:1.7rem;">&#128100;</span>
      </a>
      <span id="roleLabel" style="font-size:1.05rem; color:#6d7a6d; font-weight:600; margin-left:0.3em;"></span>
      <button id="logoutBtn" style="display:none; background:#8B5C2A; color:#fff; border:none; border-radius:8px; padding:0.5rem 1.3rem; font-size:1.1rem; font-weight:700; cursor:pointer; margin-left:0.5rem; box-shadow:0 2px 6px rgba(0,0,0,0.08);">Logout</button>
    </span>
    <button id="dropdownBtn" style="display:none; background:none; border:none; font-size:2rem; cursor:pointer; margin-left:0.7rem; color:#8B5C2A; padding:0 0.5rem; border-radius:6px;">&#9776;</button>
    <div id="dropdownMenu" style="display:none; position:absolute; top:60px; right:0; background:#fff; border-radius:12px; box-shadow:0 8px 32px rgba(0,0,0,0.12); min-width:200px; z-index:2000; padding:1rem 0;"></div>
    <button id="loginBtn" style="display:none; background:#8B5C2A; color:#fff; border:none; border-radius:8px; padding:0.5rem 1.3rem; font-size:1.1rem; font-weight:700; cursor:pointer; margin-left:1rem;">Login</button>
    <button id="signupBtn" style="display:none; background:#bfa77a; color:#fff; border:none; border-radius:8px; padding:0.5rem 1.3rem; font-size:1.1rem; font-weight:700; cursor:pointer; margin-left:0.5rem;">Sign Up</button>
  </nav>
</header>
<div style="height:84px;"></div>
<script>
// Dynamic navigation based on user role
$(function() {
  const token = localStorage.getItem('jwt_token');
  const userRole = localStorage.getItem('user_role');
  
  // Function to load user profile image
  async function loadProfileImage() {
    if (!token) {
      console.log('No token found, skipping profile image load');
      return;
    }
    
    try {
      console.log('Loading profile image...');
      const response = await fetch('http://localhost:4000/api/v1/profile', {
        headers: {
          'Authorization': `Bearer ${token}`
        }
      });
      
      console.log('Profile API response status:', response.status);
      
      if (response.ok) {
        const data = await response.json();
        console.log('Profile data:', data);
        
        if (data.success && data.profile && data.profile.profile_image) {
          const profileImage = document.getElementById('profileImage');
          const profileDefaultIcon = document.getElementById('profileDefaultIcon');
          
          if (!profileImage || !profileDefaultIcon) {
            console.error('Profile image elements not found');
            return;
          }
          
          // Set the profile image
          const imagePath = data.profile.profile_image.startsWith('http') ? 
            data.profile.profile_image : `/our${data.profile.profile_image}`;
          
          console.log('Setting profile image to:', imagePath);
          profileImage.src = imagePath;
          
          // Show image, hide default icon
          profileImage.style.display = 'block';
          profileDefaultIcon.style.display = 'none';
          
          console.log('Profile image loaded successfully');
        } else {
          console.log('No profile image found in response');
        }
      } else {
        console.error('Profile API request failed:', response.status);
      }
    } catch (error) {
      console.error('Error loading profile image:', error);
    }
  }
  
  // Show/hide elements based on authentication status
  if (token && userRole) {
    // User is logged in
    $('#loginBtn').hide();
    $('#signupBtn').hide();
    $('#profileIcon').show();
    $('#logoutBtn').show();
    $('#dropdownBtn').show();
    
    // Set profile link based on user role
    let profileLink = '';
    if (userRole === 'seller') {
      profileLink = '/our/jquery/sellers/profile-sellers.html';
    } else if (userRole === 'customer') {
      profileLink = '/our/jquery/customer/profile.html';
    } else if (userRole === 'admin') {
      profileLink = '/our/jquery/admin/profile.html';
    } else {
      profileLink = '/our/jquery/profile.html';
    }
    $('#profileIcon').attr('href', profileLink);
    
    // Load profile image with a small delay to ensure DOM is ready
    setTimeout(() => {
      loadProfileImage();
    }, 100);
    
    let roleText = '';
    if (userRole === 'seller') roleText = 'Seller';
    else if (userRole === 'customer') roleText = 'Customer';
    else if (userRole === 'admin') roleText = 'Admin';
    else if (userRole === 'user') roleText = 'User';
    else roleText = userRole.charAt(0).toUpperCase() + userRole.slice(1);
    
    $('#roleLabel').text(roleText);
    
    // Clear dropdown menu
    $('#dropdownMenu').empty();
    
    // Seller header customization
    if (userRole === 'seller') {
      $('#logoLink').attr('href', '/our/jquery/sellers/index-sellers.html');
      $('#dropdownMenu').append(`
        <a href="/our/jquery/sellers/products.html" style="display:flex; align-items:center; gap:0.7rem; color:#6d7a6d; font-size:1.1rem; text-decoration:none; padding:0.7rem 1.5rem;">Products</a>
        <a href="/our/jquery/sellers/categories.html" style="display:flex; align-items:center; gap:0.7rem; color:#6d7a6d; font-size:1.1rem; text-decoration:none; padding:0.7rem 1.5rem;">Categories</a>
        <a href="/our/jquery/sellers/orders.html" style="display:flex; align-items:center; gap:0.7rem; color:#6d7a6d; font-size:1.1rem; text-decoration:none; padding:0.7rem 1.5rem;">Orders</a>
        <a href="/our/jquery/sellers/profile-sellers.html" style="display:flex; align-items:center; gap:0.7rem; color:#6d7a6d; font-size:1.1rem; text-decoration:none; padding:0.7rem 1.5rem;">Profile</a>
        <button id="logoutBtnDropdown" style="width:90%; margin:0.7rem 5%; background:#8B5C2A; color:#fff; border:none; border-radius:8px; padding:0.5rem 1.3rem; font-size:1.1rem; font-weight:700; cursor:pointer;">Logout</button>
      `);
    }
    // Customer header customization
    else if (userRole === 'customer') {
      $('#logoLink').attr('href', '/our/jquery/customer/index.html');
      $('#dropdownMenu').append(`
        <a href="/our/jquery/customer/product_customer.html" style="display:flex; align-items:center; gap:0.7rem; color:#6d7a6d; font-size:1.1rem; text-decoration:none; padding:0.7rem 1.5rem;">Products</a>
        <a href="/our/jquery/customer/profile.html" style="display:flex; align-items:center; gap:0.7rem; color:#6d7a6d; font-size:1.1rem; text-decoration:none; padding:0.7rem 1.5rem;">Profile</a>
        <a href="/our/jquery/customer/wishlist.html" style="display:flex; align-items:center; gap:0.7rem; color:#6d7a6d; font-size:1.1rem; text-decoration:none; padding:0.7rem 1.5rem;">Wishlist</a>
        <a href="/our/jquery/customer/cart.html" style="display:flex; align-items:center; gap:0.7rem; color:#6d7a6d; font-size:1.1rem; text-decoration:none; padding:0.7rem 1.5rem;">Cart</a>
        <a href="/our/jquery/customer/order-history.html" style="display:flex; align-items:center; gap:0.7rem; color:#6d7a6d; font-size:1.1rem; text-decoration:none; padding:0.7rem 1.5rem;">Orders</a>
        <button id="logoutBtnDropdown" style="width:90%; margin:0.7rem 5%; background:#8B5C2A; color:#fff; border:none; border-radius:8px; padding:0.5rem 1.3rem; font-size:1.1rem; font-weight:700; cursor:pointer;">Logout</button>
      `);
    }
    // Admin header customization
    else if (userRole === 'admin') {
      $('#logoLink').attr('href', '/our/jquery/admin/index.html');
      $('#dropdownMenu').append(`
        <a href="/our/jquery/admin/index.html" style="display:flex; align-items:center; gap:0.7rem; color:#6d7a6d; font-size:1.1rem; text-decoration:none; padding:0.7rem 1.5rem;">Dashboard</a>
        <a href="/our/jquery/admin/users.html" style="display:flex; align-items:center; gap:0.7rem; color:#6d7a6d; font-size:1.1rem; text-decoration:none; padding:0.7rem 1.5rem;">Users</a>
        <a href="/our/jquery/admin/customers.html" style="display:flex; align-items:center; gap:0.7rem; color:#6d7a6d; font-size:1.1rem; text-decoration:none; padding:0.7rem 1.5rem;">Customers</a>
        <a href="/our/jquery/admin/sellers.html" style="display:flex; align-items:center; gap:0.7rem; color:#6d7a6d; font-size:1.1rem; text-decoration:none; padding:0.7rem 1.5rem;">Sellers</a>
        <a href="/our/jquery/admin/items.html" style="display:flex; align-items:center; gap:0.7rem; color:#6d7a6d; font-size:1.1rem; text-decoration:none; padding:0.7rem 1.5rem;">Items</a>
        <button id="logoutBtnDropdown" style="width:90%; margin:0.7rem 5%; background:#8B5C2A; color:#fff; border:none; border-radius:8px; padding:0.5rem 1.3rem; font-size:1.1rem; font-weight:700; cursor:pointer;">Logout</button>
      `);
    }
    // Regular user header customization (role: 'user')
    else if (userRole === 'user') {
      $('#logoLink').attr('href', '/our/jquery/index.html');
      $('#dropdownMenu').append(`
        <a href="/our/jquery/product_catalog.html" style="display:flex; align-items:center; gap:0.7rem; color:#6d7a6d; font-size:1.1rem; text-decoration:none; padding:0.7rem 1.5rem;">Products</a>
        <a href="/our/jquery/profile.html" style="display:flex; align-items:center; gap:0.7rem; color:#6d7a6d; font-size:1.1rem; text-decoration:none; padding:0.7rem 1.5rem;">Profile</a>
        <button id="logoutBtnDropdown" style="width:90%; margin:0.7rem 5%; background:#8B5C2A; color:#fff; border:none; border-radius:8px; padding:0.5rem 1.3rem; font-size:1.1rem; font-weight:700; cursor:pointer;">Logout</button>
      `);
    }
    
    // Dropdown toggle functionality
    $('#dropdownBtn').off('click').on('click', function() {
      $('#dropdownMenu').toggle();
    });
    
    // Logout functionality
    $('#logoutBtn, #logoutBtnDropdown').off('click').on('click', function() {
      localStorage.removeItem('jwt_token');
      localStorage.removeItem('user_role');
      localStorage.removeItem('user_name');
      localStorage.removeItem('user_email');
      localStorage.removeItem('login_time');
      window.location.href = '/our/jquery/index.html';
    });
    
    // Listen for profile updates
    window.addEventListener('profileUpdated', function() {
      console.log('Profile updated, reloading profile image...');
      setTimeout(() => {
        loadProfileImage();
      }, 500);
    });
    
    // Expose reload function globally
    window.reloadProfileImage = loadProfileImage;
  } else {
    // User is not logged in
    $('#profileIcon').hide();
    $('#logoutBtn').hide();
    $('#dropdownBtn').hide();
    $('#loginBtn').show();
    $('#signupBtn').show();
    $('#roleLabel').text('');
    
    // Add Products link for guests
    $('<a href="/our/jquery/product_catalog.html" style="background:#bfa77a; color:#fff; border:none; border-radius:8px; padding:0.5rem 1.3rem; font-size:1.1rem; font-weight:700; text-decoration:none; margin-right:0.5rem;">Products</a>').insertBefore('#loginBtn');
    
    // Add click handlers for login and signup buttons
    $('#loginBtn').off('click').on('click', function() {
      window.location.href = '/our/jquery/login.html';
    });
    
    $('#signupBtn').off('click').on('click', function() {
      window.location.href = '/our/jquery/signup.html';
    });
  }
});
</script> 